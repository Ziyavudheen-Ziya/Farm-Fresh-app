<%- include('../adminpartials/adminheader') %>


<style>
    .border {
    border: var(--bs-border-width) var(--bs-border-style) var(--bs-border-color) !important;
    margin-left: -348px;
}
</style>

<head>

    <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>





    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/jquery.validate.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.all.min.js"></script>
</head>

  
<main class="main-wrap">

  
   <br>
   <br>
<section class="content lists col-md-10" style="padding-left: 100px;">
    <div>
        <div class="border rounded p-2">
          <div class="search d-md-flex justify-content-between border-bottom p-2">
            <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#exampleModal">
              Add Offer
            </button>
      
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-body">
                    <form id="add-category-offer">
                      <div class="head text-center my-2">
                        <h3>Add Offer</h3>
                      </div>
                      <div class="mb-3">
                        <label for="offerCategory" class="form-label">offer Category</label>
                        <input type="text" id="offerCategory" name="offerCategory" class="form-control" />
                      </div>
                      <div class="mb-3">
                        <label for="offerAmount" class="form-label">Offer Amount</label>
                        <input type="number" id="offerAmount" name="offerAmount" class="form-control" />
                      </div>
                      <div class="mb-3">
                        <label for="startDate" class="form-label">Start Date</label>
                        <input type="date" id="startDate" name="startDate" class="form-control" />
                      </div>
                      <div class="mb-3">
                        <label for="endDate" class="form-label">End Date</label>
                        <input type="date" id="endDate" name="endDate" class="form-control" />
                      </div>
                      <div class="mb-3 text-center">
                        <button type="submit" class="btn btn-dark">Submit</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
       <div class="table-responsive content">
         <table class="table">
           <thead>
             <tr>
               <th scope="col">#</th>
               <th scope="col">Category</th>
               <th scope="col">Offer Amount</th>
               <th scope="col">Start Date</th>
               <th scope="col">End Date</th>
               <th scope="col">Status</th>
               <th scope="col">Action</th>
             </tr>
           </thead>
           <%categoryOfferData.forEach((data,index)=>{%>

          
           <tbody>
     
             <tr>
               <td><%=index+1%></td>
               <td><%=data.categoryName%></td>
               <td><%=data.productOfferAmount%></td>
               <td><%=data.startDate.toLocaleDateString() %></td>
               <td><%=data.endDate.toLocaleDateString() %></td>

               <% const isActive = new Date(data.endDate) > new Date(); %>
               <% if (isActive) { %>


               <td>


                 <a
                   href="/categoryOfferStatus/"
                   class="btn btn-success"
                   >Available</a
                 >

               </td>
               <% } else { %>

 
              
 
               <td>
                 <a
                   href="/categoryOfferStatus/"
                   class="btn btn-danger"
                   >Not Available</a
                 >
               </td>
               <% } %>

               <td>
                 <button
                   type="button"
                   class="btn btn-dark"
                   data-bs-toggle="modal"
                   data-bs-target="#edit-offer"
                 >
                   Edit
                 </button>
                 <div
                   class="modal fade"
                   id="edit-offer"
                   tabindex="-1"
                   aria-labelledby="exampleModalLabel"
                   aria-hidden="true"
                 >
                   <div class="modal-dialog">
                     <div class="modal-content">
                       <div class="modal-body">
                         <form id="edit-category-offer">
                           <div class="head text-center my-2">
                             <h3>Edit Offer</h3>
                           </div>
                           <div class="mb-3">
                             <label for="categoryName" class="form-label"
                               >Product</label
                             >
                             <input
                               type="text"
                               id="categoryName"
                               name="categoryName"
                               class="hidden"
                               value="<%=data.categoryName%>"
                             />
                             <input
                               type="text"
                               class="form-control disabled"
                               value="<%=data.categoryName%>"
                               disabled
                             />
                           </div>
                           <div class="mb-3">
                             <label for="offerAmount" class="form-label"
                               >Offer Amount</label
                             >
                             <input
                               type="number"
                               id="offerAmount"
                               name="offerAmount"
                               class="form-control"
                               value="<%=data.productOfferAmount%>"
                             />
                           </div>
 
                           <div class="mb-3">
                             <label for="startDate" class="form-label"
                               >Start Date</label
                             >
                             <input
                               type="date"
                               id="startDate"
                               name="startDate"
                               class="form-control"
                               value="<%=data.startDate%>"
                             />
                           </div>
                           <div class="mb-3">
                             <label for="endDate" class="form-label"
                               >End Date</label
                             >
                             <input
                               type="date"
                               id="endDate"
                               name="endDate"
                               class="form-control"
                               value="<%=data.endDate%>"
                             />
                           </div>
                           <div class="mb-3 text-center">
                             <button class="btn btn-dark">Submit</button>
                           </div>
                         </form>
                       </div>
                     </div>
                   </div>
                 </div>
               </td>
             </tr>
            
           </tbody>

           <%})%>
         </table>
         <div class="d-flex justify-content-center py-3">
          <nav aria-label="Page navigation example">
              <ul class="pagination">
                  <li class="page-item"><a class="page-link">Pages</a></li>
      
                  <%for(let i=0;i<totalPages;i++){%>
      
                      <li class="page-item">
                        
      
      
                       
                          <a class="page-link" href="/categoryOffer?pageNo=<%=i+1%>"><%=i+1%> </a>
                      </li>
                  <%}%>
                   
              </ul>
      
      </div>
       </div>
     </div>
   </div>
 </section>
 <style>
   .error{
       color: red;
   }
 </style>


 
 
   
<script>

    
$(document).ready(function() {
    console.log("Document is ready");
  
    $("#add-category-offer").validate({
      rules: {
        offerCategory: {
          required: true
        },
        offerAmount: {
          required: true,
          digits: true
        },
        startDate: {
          required: true,
          date: true
        },
        endDate: {
          required: true,
          date: true
        }
      },
      submitHandler: async function(form, event) {
        event.preventDefault();
  
        let formData = {
          categoryName: form.offerCategory.value,
          productOfferAmount: form.offerAmount.value,
          startDate: form.startDate.value,
          endDate: form.endDate.value
        };
  
        try {
          let response = await fetch('/categoryOfferAdding', {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });
  
          let result = await response.json();
  
          if (result.success) {
            await Swal.fire({
              icon: "success",
              title: "Category Offer Product Added"
            });
  
            window.location.reload();


          } 


            if(result.categoryNotExsist){

                 await Swal.fire({
                     icon:"error",
                     title:"Not exsist in category"
                 })

                 window.location.reload()
            }
        } catch (error) {
          console.error('Error:', error);
        }
      }
    });
  });




</script>

<script>

    $(document).ready(function(){

     

        $('#edit-category-offer').validate({

             rules:{

              categoryName:{
                required:true

              },


              offerAmount:{
                  
                  required:true,
                  digits:true
              },
              startDate:{
                  
                required:true,
                date:true
              },
              endDate:{
                 required:true,
                 date:true
              }

                 

             },


             submitHandler:async function (form,event){

                    event.preventDefault();


                    let formData = {
                      categoryName:form.categoryName.value,
                      productOfferAmount:form.offerAmount.value,
                      startDate:form.startDate.value,
                      endDate:form.endDate.value
                    }

                    let response = await fetch(`/editCategoryOffer`,{

                         method:"POST",
                         headers:{'Content-Type':'application/json'},
                         body:JSON.stringify(formData)
                    })


                    let result = await response.json()

                    if(result.success){

                      await Swal.fire({
                          
                        icon:'success',
                        title:"Successfullt edited"
                      })

                      window.location.reload()
                    }
             }
        })
    })
</script>

  





















<%- include('../adminpartials/adminfooter') %>
